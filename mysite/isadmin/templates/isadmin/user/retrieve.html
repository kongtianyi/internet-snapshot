<!DOCTYPE html>
<html lang="zh-Han">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<title>重置密码 - 互联网站点劫持检测系统</title>
        {% load static %}

		<meta name="description" content="User login page" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

        <link rel="shortcut icon" href="/static/isadmin/images/favicon.ico">

		<!-- bootstrap & fontawesome -->
        <link rel="stylesheet" href="{% static 'isadmin/css/bootstrap.min.css' %}" />
        <link rel="stylesheet" href="{% static 'isadmin/font-awesome/4.5.0/css/font-awesome.min.css' %}" />

		<!-- text fonts -->
        <link rel="stylesheet" href="{% static 'isadmin/css/fonts.googleapis.com.css' %}" />

        <!-- ace styles -->
        <link rel="stylesheet" href="{% static 'isadmin/css/ace.min.css' %}" class="ace-main-stylesheet" id="main-ace-style" />

		<!--[if lte IE 9]>
			<link rel="stylesheet" href="{% static 'isadmin/css/ace-part2.min.css' %}" class="ace-main-stylesheet" />
		<![endif]-->
        <link rel="stylesheet" href="{% static 'isadmin/css/ace-skins.min.css' %}" />
        <link rel="stylesheet" href="{% static 'isadmin/css/ace-rtl.min.css' %}" />

        <!--[if lte IE 9]>
		    <link rel="stylesheet" href="{% static 'isadmin/css/ace-ie.min.css' %}" />
		<![endif]-->

        <!-- inline styles related to this page -->

        <!-- ace settings handler -->
        <script src="{% static 'isadmin/js/ace-extra.min.js' %}"></script>

        <!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

        <!--[if lte IE 8]>
		    <script src="{% static 'isadmin/js/html5shiv.min.js' %}"></script>
		    <script src="{% static 'isadmin/js/respond.min.js' %}"></script>
		<![endif]-->
	</head>

	<body class="login-layout">
		<div class="main-container">
			<div class="main-content">
				<div class="row">
					<div class="col-sm-10 col-sm-offset-1">
						<div class="login-container">
							<div class="center">
								<h1>
									<i class="ace-icon fa fa-leaf green"></i>
									<span class="red">互联网站点</span>
                                    <br>
									<span class="white" id="id-text2">劫持检测系统</span>
								</h1>
								<h4 class="blue" id="id-company-text">&copy; <a href="https://github.com/kongtianyi" target="_blank">kongtianyi</a></h4>
							</div>

							<div class="space-6"></div>

							<div class="position-relative">
								<div id="signup-box" class="signup-box visible widget-box no-border">
									<div class="widget-body">
										<div class="widget-main">
											<h4 class="header green lighter bigger">
												<i class="ace-icon fa fa-users blue"></i>
												重置密码
											</h4>

											<div class="space-6"></div>
											<p> 请输入您的新密码: </p>

											<form>
												<fieldset>
													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input id="retrieve_password" name="password" type="password" class="form-control" placeholder="新密码" />
															<i class="ace-icon fa fa-lock"></i>
														</span>
													</label>

													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input id="retrieve_repeat_password" name="repeat_password" type="password" class="form-control" placeholder="重复新密码" />
															<i class="ace-icon fa fa-retweet"></i>
														</span>
													</label>

													<div class="space-24"></div>

													<div class="clearfix">
														<button type="reset" class="width-30 pull-left btn btn-sm">
															<i class="ace-icon fa fa-refresh"></i>
															<span class="bigger-110">重置</span>
														</button>

														<button onclick="retrieve();" type="button" class="width-65 pull-right btn btn-sm btn-success">
															<span class="bigger-110">提交</span>

															<i class="ace-icon fa fa-arrow-right icon-on-right"></i>
                                                        </button>
													</div>
												</fieldset>
											</form>
										</div>
									</div><!-- /.widget-body -->
								</div><!-- /.signup-box -->
							</div><!-- /.position-relative -->

							<div class="navbar-fixed-top align-right">
								<br />
								&nbsp;
								<a id="btn-login-dark" href="#">Dark</a>
								&nbsp;
								<span class="blue">/</span>
								&nbsp;
								<a id="btn-login-blur" href="#">Blur</a>
								&nbsp;
								<span class="blue">/</span>
								&nbsp;
								<a id="btn-login-light" href="#">Light</a>
								&nbsp; &nbsp; &nbsp;
							</div>
						</div>
					</div><!-- /.col -->
				</div><!-- /.row -->
			</div><!-- /.main-content -->
		</div><!-- /.main-container -->

		<!-- basic scripts -->

		<!--[if !IE]> -->
		<script src="{% static 'isadmin/js/jquery-2.1.4.min.js' %}"></script>

		<!-- <![endif]-->

		<!--[if IE]>
            <script src="{% static 'isadmin/js/jquery-1.11.3.min.js' %}"></script>
        <![endif]-->
		<script type="text/javascript">
			if('ontouchstart' in document.documentElement) document.write("<script src='{% static 'isadmin/js/jquery.mobile.custom.min.js' %}'>"+"<"+"/script>");
		</script>

        <!-- page specific plugin scripts -->
        <script src="{% static 'isadmin/js/bootstrap.min.js' %}"></script>
        <script src="{% static 'isadmin/js/bootbox.js' %}"></script>

		<!-- inline scripts related to this page -->
		<script type="text/javascript">
            jQuery(function($) {
                $(document).on('click', '.toolbar a[data-target]', function(e) {
                    e.preventDefault();
                    var target = $(this).data('target');
                    $('.widget-box.visible').removeClass('visible');//hide others
                    $(target).addClass('visible');//show target
                });
            });



            //you don't need this, just used for changing background
            jQuery(function($) {
                $('#btn-login-dark').on('click', function(e) {
                    $('body').attr('class', 'login-layout');
                    $('#id-text2').attr('class', 'white');
                    $('#id-company-text').attr('class', 'blue');

                    e.preventDefault();
                });
                $('#btn-login-light').on('click', function(e) {
                    $('body').attr('class', 'login-layout light-login');
                    $('#id-text2').attr('class', 'grey');
                    $('#id-company-text').attr('class', 'blue');

                    e.preventDefault();
                });
                $('#btn-login-blur').on('click', function(e) {
                    $('body').attr('class', 'login-layout blur-login');
                    $('#id-text2').attr('class', 'white');
                    $('#id-company-text').attr('class', 'light-blue');

                    e.preventDefault();
                });

            });

            /* 重置密码请求 */
            function retrieve() {
                var retrieve_password  = $("#retrieve_password");
                var retrieve_repeat_password = $("#retrieve_repeat_password");
                var jq_list = [retrieve_password, retrieve_repeat_password];
                var show_list = ["新密码", "重复新密码"];
                for(var i=0;i<jq_list.length;i++) {
                    if($.trim(jq_list[i].val()) == "") {
                        bootbox.alert("请输入"+show_list[i]+"。");
                        jq_list[i][0].focus();
                        return;
                    }
                }
                $.ajax({
                    "url": "/isadmin/retrieve_action",
                    "type": "post",
                    "data": {
                        "password": retrieve_password.val(),
                        "repeat_password": retrieve_repeat_password.val(),
                        "token": "{{ token }}"
                    },
                    "success": function (data) {
                        if(data["status"] == "success") {
                            bootbox.dialog({
                                message: "重置密码成功，点击确定跳转登陆页。",
                                buttons: {
                                    "success": {
                                        "label": "确定",
                                        "className": "btn-sm btn-primary",
                                        "callback": function () {
                                            window.location.href="/isadmin/login";
                                        }
                                    }
                                }
                            });
                        } else {
                            bootbox.dialog({
                                message: data["message"],
                                buttons: {
                                    "success": {
                                        "label": "确定",
                                        "className": "btn-sm btn-primary"
                                    }
                                }
                            });
                        }
                    },
                    "error": function () {
                        bootbox.alert("服务端出错，请稍后重试。");
                    }
                });
            }
		</script>
	</body>
</html>
